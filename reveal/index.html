<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>DiY IoT - Easy as Pi!</title>

    <meta name="description" content="DIY Raspberry Pi Stuff">
    <meta name="author" content="Benoit Mangili">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/beige.css" id="theme">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">



    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="my.css">

  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
 
        <section>
          <h1>DIY IoT - Easy as Pi!</h1>
          <aside class="notes">
            You've heard about the internet of things. Today we will tell you how you can make it work for you. 
            Hack your thermostat, automate tedious tasks like watering your plants, let your pi read out the weather, let your house send tweets when the alarm goes off, the opportunities are endless. And it is not that hard to get started!
            In fact, today we'll show you how easy it is!
          </aside>
        </section>
        <section>
          <p class="fragment">We want to be able to control things. Insert image of control cycle with sensor and actuator here.</p>
          <p class="fragment">We want to be able to display things. Insert a mock picture of a gui with a graph and some buttons here.</p>

          <aside class="notes">
            We will do this today by using a raspberry pi. 
            * We will start by showing you how the raspberry pi can talk to an actuator (a relay). 
            * Then we'll show you how to control the actuator from a web app, rather than having to run the commands on the pi itself. 
            * Then we'll go back to the other part of the control loop: the sensor. We'll use the pi to read in sensor data. 
            * We'll display those sensor data in the web app.
            * At the end we'll close the loop and bring it all together.
            We are going to be using a temperature sensor to control the state of a lamp but of course you can extend this to anything you can imagine:
            water your plants using a pump and a humidity sensor, text yourself a picture of a guest who is ringing your doorbell, whatever you can think of that has these basic components of a sensor and an actuator. Of course you can also just display data without acting on it.
            If we make it through the end quickly enough we also have an all out crazy nuclear demo for you, involving twitter, speakers and yourselves.
          </aside>
        </section>
        <!-- Part 1 -->
        <section>
            <section>
                <h2>Part 1: Controll a switch with the Pi</h2>
            </section>
            <section>
              <h1>Raspberry Pi Basics</h1>
                  <img data-src="img/raspberry_pi.jpeg">
              <aside class="notes">
              Mention: 
              It is a computer and a micro-controller.
              It has pins that you can connect stuff to and you can control the state of the pins.
              It comes with python.
              </aside>
            </section>
            <section>
            <span class="fragment">
            <pre class="python"><code data-trim contenteditable>
import RPi.GPIO as GPIO
# Set the pi to board mode
GPIO.setmode(GPIO.BOARD)
</code></pre>
            </span>
            <span class="fragment">
            <pre class="python"><code data-trim contenteditable>
# Set up
pin = 36
GPIO.setup(pin, GPIO.OUT)
</code></pre>
            </span>
            <span class="fragment">
            <pre class="python"><code data-trim contenteditable>
# Set pin voltage to high
GPIO.output(pin, GPIO.HIGH)
</code></pre>
            </span>
            <span class="fragment">
            <pre class="python"><code data-trim contenteditable>
# Set pin voltage to low
GPIO.output(pin, GPIO.LOW)
</code></pre>
            </span>
            <span class="fragment">
            <pre class="python"><code data-trim contenteditable>
# Clear up
GPIO.cleanup()
            </code></pre>
          </span>
            </section>
            <section>
                <h3>How do you know which pin is which?</h3>
                <img class="stretch" data-src="img/GPIO_Layout.png">
            </section>
       </section>
       <!-- Part 2 -->
       <section>
           <section>
              <h2>Part 2: Controlling a lamp via the web</h2>
              <aside class="notes">
              For people to type /on or /off to controll the lamp
              </aside>
           </section>
            <section>

            <pre class="python"><code data-trim contenteditable>
from flask import Flask
app = Flask(__name__)
</code></pre>

            <span class="fragment">
            <pre class="python"><code data-trim contenteditable>
# Return hello world to the index page
@app.route('/')
def hello_world():
    return '<h1 align="center">Greetings, Stevenage Branch!</h1>' \
           '<p align="center">We hope you enjoy the show!</p>'
</code></pre>
            </span>
            <span class="fragment">
            <pre class="python"><code data-trim contenteditable>
@app.route('/lamp/on')
def turn_me_on():
    GPIO.output(pin, GPIO.HIGH)
    return '<h1 align="center">Turning the lamp on</h1>'
</code></pre>
            </span>
            <span class="fragment">
            <pre class="python"><code data-trim contenteditable>
@app.route('/lamp/off')
def turn_me_off():
    GPIO.output(pin, GPIO.LOW)
    return '<h1 align="center">Turning the lamp off</h1>'
</code></pre>
            </span>
            <span class="fragment">
            <pre class="python"><code data-trim contenteditable>
        app.run(host='0.0.0.0', port=8080, debug=True)
            </code></pre>
          </span>
              <aside class="notes">
              Tell people this only works within the wifi network (which is usualy a good thing).
                  It is possible to open up a port to the outside world but then need to be careful about safety.
              </aside>
            </section>
            <section>
                <h2>Now using a proper web app!</h2>
                <aside class="notes">
                Controlling the lamp with on/off buttons
                </aside>
            </section>
            <section>

            <pre class="python"><code data-trim contenteditable>
from flask import Flask, request, jsonify, render_template
</code></pre>

            <span class="fragment">
            <pre class="python"><code data-trim contenteditable>
@app.route('/')
def hello_world():
    return render_template('index_part2b.html')
</code></pre>
            </span>
            <span class="fragment">
            <pre class="python"><code data-trim contenteditable>
@app.route('/lamp', methods=['GET', 'PUT'])
def lamp_stuff():
    if request.method == 'PUT':
        # Change state
        data = request.form
        state = data['state']

        set_gpio_state(state)

    # confirm the state has been set
    state = get_gpio_state(pin)

    return jsonify(state=state)
</code></pre>
            </span>
            <span class="fragment">
            <pre class="python"><code data-trim contenteditable>
        app.run(host='0.0.0.0', port=8080, debug=True)
            </code></pre>
          </span>
            <aside class="notes">
            Tell people how it works: Javascript registers button click -> sends request to server to change state -> server changes state
            (-> server returns changed state info -> javascript changes css to change red circle colour)
           </aside>
            </section>
        </section>
        <!-- Part 3 -->
        <section>
            <section>
                <h2>Part 3: The sensor</h2>
            </section>
            <section>
              It's just reading a file!
              <aside class="notes">
              show code snipped of file read
              </aside>
            </section>
            <section>
              But we can wrap it in a python class.
             <aside class="notes">
              There are different protocolls for talking to devices, w1, i2c, etc. the pi has a lot of these available.
              </aside>  
            </section>
            <section>
              Now show the temperature in the web app. We are almost there!
            </section>
         </section> 
       <!-- Part 4 -->               
       <section>
        <h2>Part 4: Bringing it all together - a proper control loop!</h2>
        <aside class="notes">
              Set set point and dip sensor in ice water and warm it up by hand.
         </aside>
       </section>
       <!-- Part 5 -->
        <section>
        <h2>Bonus level unlocked:</h2>
        <h3>Let's vote on twitter whether to turn on "the heating"!</h3>
       </section>
      </div>

    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,
        slideNumber: true,
        overview: true,

        //parallaxBackgroundImage: 'img/xkcd.jpg',
        //parallaxBackgroundSize: '1024px 768px',

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        // Bounds for smallest/largest possible scale to apply to content
        minScale: 0.2,
        maxScale: 1.5,
        transition: 'slide', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js',
            async: true,
            // condition: function() { 
            //   return !!document.querySelector( 'pre code' );
            // },
            callback: function() {
              [].forEach.call(document.querySelectorAll('.highlight, pre code'),
                function(v,i){
                  hljs.highlightBlock(v);
                })
            } 
          },
          { src: 'plugin/zoom-js/zoom.js', async: true },
          { src: 'plugin/notes/notes.js', async: true }
        ]
      });

    </script>

  </body>
</html>
